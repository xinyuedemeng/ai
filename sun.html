<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D 太阳系模拟</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Three.js 核心库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- 引入 OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <!-- 引入 dat.GUI -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #000000; font-family: 'Inter', sans-serif; }
        canvas { display: block; }
        
        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            color: white;
            padding: 10px 20px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 30px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }
        .fullscreen-btn:hover { background-color: rgba(255, 255, 255, 0.25); transform: translateX(-50%) scale(1.05); }

        .label {
            position: absolute;
            color: white;
            font-size: 12px;
            pointer-events: none;
            text-shadow: 0 0 2px black;
        }
    </style>
</head>
<body>

    <div id="container"></div>

    <button id="fullscreenButton" class="fullscreen-btn">
        ⛶ 全屏模式
    </button>

    <script>
        // --- 全局变量 ---
        let scene, camera, renderer, controls, gui;
        let sun;
        let planets = [];
        let orbits = [];
        let clock = new THREE.Clock();

        // 太阳系数据配置 (为了视觉效果，大小和距离非真实比例)
        const planetData = [
            { name: "水星 (Mercury)", radius: 2, distance: 45, color: 0xA5A5A5, speed: 0.04 },
            { name: "金星 (Venus)", radius: 3.5, distance: 65, color: 0xE3BB76, speed: 0.03 },
            { name: "地球 (Earth)", radius: 3.6, distance: 90, color: 0x22A6F2, speed: 0.025 },
            { name: "火星 (Mars)", radius: 2.8, distance: 115, color: 0xFF5733, speed: 0.02 },
            { name: "木星 (Jupiter)", radius: 10, distance: 160, color: 0xD9A066, speed: 0.012 },
            { name: "土星 (Saturn)", radius: 8.5, distance: 210, color: 0xEAD6B8, speed: 0.009, hasRing: true },
            { name: "天王星 (Uranus)", radius: 6, distance: 260, color: 0x4FD0E7, speed: 0.006 },
            { name: "海王星 (Neptune)", radius: 5.8, distance: 300, color: 0x3E54E8, speed: 0.004 }
        ];

        const params = {
            rotationSpeed: 1.0, // 全局运行速度
            showOrbits: true
        };

        // --- Three.js 初始化 ---
        function initThree() {
            scene = new THREE.Scene();
            // 星空背景雾效，营造深邃感
            scene.fog = new THREE.FogExp2(0x000000, 0.0015);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            // 开启阴影映射
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.set(0, 150, 400); // 俯视视角
            
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 50;
            controls.maxDistance = 1000;

            // 1. 创建星空背景
            createStars();

            // 2. 创建太阳
            createSun();

            // 3. 创建行星
            createPlanets();

            // 4. GUI 控制
            initGUI();
            
            window.addEventListener('resize', onWindowResize);
            document.getElementById('fullscreenButton').addEventListener('click', toggleFullscreen);

            animate();
        }

        function createStars() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 1.5, transparent: true, opacity: 0.8 });
            const starCount = 5000;
            const starPositions = new Float32Array(starCount * 3);
            
            for(let i=0; i<starCount; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starPositions[i*3] = x;
                starPositions[i*3+1] = y;
                starPositions[i*3+2] = z;
            }
            
            starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        function createSun() {
            // 太阳几何体
            const sunGeometry = new THREE.SphereGeometry(25, 64, 64);
            // 基础材质（自发光效果，不受光照影响）
            const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xFFD700 }); 
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            scene.add(sun);

            // 太阳发光效果 (点光源)
            const sunlight = new THREE.PointLight(0xffffff, 1.5, 1000);
            sunlight.position.set(0, 0, 0);
            sunlight.castShadow = true;
            scene.add(sunlight);
            
            // 添加一点环境光，保证背光面不是全黑
            const ambientLight = new THREE.AmbientLight(0x404040, 0.2); 
            scene.add(ambientLight);

            // 太阳光晕 (简单的发光层)
            const glowGeometry = new THREE.SphereGeometry(27, 32, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({ color: 0xFF4500, transparent: true, opacity: 0.3, side: THREE.BackSide });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            scene.add(glow);
        }

        function createPlanets() {
            planetData.forEach(data => {
                const planetGroup = new THREE.Group();
                
                // 1. 创建行星本体
                const geometry = new THREE.SphereGeometry(data.radius, 32, 32);
                const material = new THREE.MeshStandardMaterial({ 
                    color: data.color,
                    roughness: 0.7,
                    metalness: 0.1
                });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                
                // 2. 如果是土星，添加光环
                if (data.hasRing) {
                    const ringGeometry = new THREE.RingGeometry(data.radius * 1.4, data.radius * 2.2, 64);
                    const ringMaterial = new THREE.MeshBasicMaterial({ 
                        color: 0xC0AD89, 
                        side: THREE.DoubleSide, 
                        transparent: true, 
                        opacity: 0.7 
                    });
                    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                    ring.rotation.x = Math.PI / 2; // 水平放置
                    ring.rotation.y = 0.2; // 稍微倾斜
                    mesh.add(ring);
                }

                planetGroup.add(mesh);
                scene.add(planetGroup);

                // 保存引用以便动画使用
                planets.push({
                    mesh: mesh,
                    group: planetGroup,
                    data: data,
                    angle: Math.random() * Math.PI * 2 // 随机初始角度
                });

                // 3. 创建轨道线
                const orbitGeometry = new THREE.RingGeometry(data.distance - 0.2, data.distance + 0.2, 128);
                const orbitMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0xffffff, 
                    side: THREE.DoubleSide, 
                    transparent: true, 
                    opacity: 0.15 
                });
                const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbit.rotation.x = Math.PI / 2;
                scene.add(orbit);
                orbits.push(orbit);
            });
        }

        function initGUI() {
            gui = new dat.GUI({ autoPlace: false });
            gui.domElement.style.position = 'fixed';
            gui.domElement.style.top = '10px';
            gui.domElement.style.right = '10px';
            document.body.appendChild(gui.domElement);

            gui.add(params, 'rotationSpeed', 0, 5).name('运行速度');
            gui.add(params, 'showOrbits').name('显示轨道').onChange(visible => {
                orbits.forEach(o => o.visible = visible);
            });
        }

        // --- 核心动画循环 ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            // 太阳自转
            if (sun) sun.rotation.y += 0.002;

            // 行星公转与自转
            planets.forEach(p => {
                // 更新公转角度
                p.angle += p.data.speed * 0.1 * params.rotationSpeed;
                
                // 设置位置
                p.group.position.x = Math.cos(p.angle) * p.data.distance;
                p.group.position.z = Math.sin(p.angle) * p.data.distance;
                
                // 行星自转
                p.mesh.rotation.y += 0.01;
            });

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) document.body.requestFullscreen().catch(e=>console.log(e));
            else document.exitFullscreen();
        }

        window.onload = function () {
            initThree();
        }
    </script>
</body>
</html>
